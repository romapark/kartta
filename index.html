<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Karttaesimerkki</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="tyyli.css" />
  
</head>
<body>

<h2>Karttasovellus</h2>

<div id="container">
  <div id="filters">
    <fieldset>
      <legend>Resort open</legend>
    </fieldset>
    <fieldset>
      <legend>Parks</legend>
      <label><input type="checkbox" id="pro"> Pro</label><br>
      <label><input type="checkbox" id="medium"> Medium</label><br>
      <label><input type="checkbox" id="beginner"> Beginner</label><br>
      <label><input type="checkbox" id="superpipe"> Superpipe</label><br>
      <label><input type="checkbox" id="minipipe"> Minipipe</label>
      <label><input type="checkbox" id="moguls"> Moguls</label>
    </fieldset>
    <button id="applyFilters">Filter</button>
  </div>

  <div id="map"></div>
</div>

<!-- Leafletin JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
  // Luodaan kartta
  var map = L.map('map').setView([60.1699, 24.9384], 5); // Helsinki

  // Lisätään OpenStreetMap-laatat
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '© OpenStreetMap'
  }).addTo(map);


  let markers = []; // tallennetaan kaikki markkerit


  Papa.parse("https://docs.google.com/spreadsheets/d/e/2PACX-1vThmKqPSHyVmucq094HTnClwDkDp2fZi9tgzzVHZTahCKjeS8gNyGXGK5TyGzFTXysn6vsKq09CoBtc/pub?output=csv", {
      download: true,
      header: true,
      complete: function(results) {
          const data = results.data; // Tämä on nyt JSON-taulukko

          data.forEach(r => {
              // Muunna boolean-arvot
              ["pro","medium","beginner","superpipe","minipipe","moguls"].forEach(f => {
                  r[f] = r[f] === "TRUE";
              });

              // Muunna lat/lon luvuiksi
              const lat = parseFloat(r.lat);
              const lon = parseFloat(r.lon);

              let marker = L.marker([lat, lon])
                  .addTo(map)
                  .bindPopup(`
                      <b>${r.name}</b><br>
                      Season dates: ${r.seasonStart} – ${r.seasonEnd}<br>
                      Parks: ${["pro","medium","beginner","superpipe","minipipe"]
                          .filter(f => r[f])
                          .join(', ')}<br>
                      Park condition: ${r.parkCondition || 'N/A'}
                  `);

              marker.data = r;
              markers.push(marker);
          });
      }
  });

  // Filtterin logiikka
  document.getElementById('applyFilters').addEventListener('click', () => {
    const pro = document.getElementById('pro').checked;
    const medium = document.getElementById('medium').checked;
    const beginner = document.getElementById('beginner').checked;
    const superpipe = document.getElementById('superpipe').checked;
    const minipipe = document.getElementById('minipipe').checked;

    markers.forEach(m => {
      const d = m.data;
      const show = (!pro || d.pro) &&
                   (!medium || d.medium) &&
                   (!beginner || d.beginner) &&
                   (!superpipe || d.superpipe) &&
                   (!minipipe || d.minipipe);

      if (show) {
        m.addTo(map);
      } else {
        map.removeLayer(m);
      }
    });
  });


</script>

</body>
</html>