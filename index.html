<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ski Resort Map</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="tyyli.css" />
</head>
<body>

  <!-- üîé Haku -->
  <div id="searchBox">
    <input type="text" id="searchInput" placeholder="Search resort...">
    <ul id="suggestions"></ul>
  </div>

  <div id="container">

    <!-- üß© Suodattimet -->
    <div id="filterBox">
      <div id="filters-content">
        <fieldset>
          <legend>Ski Resort</legend>
          <label for="countryInput">Select country:</label><br>
          <input id="countryInput" type="text" placeholder="Country..." list="countryList" />
          <datalist id="countryList"></datalist>
        </fieldset>

        <fieldset>
          <legend>Slopes</legend>
        </fieldset>

        <fieldset>
          <legend>Parks</legend>
          <strong>Difficulty</strong><br>
          <label><input type="checkbox" id="s_park"> S</label>
          <label><input type="checkbox" id="m_park"> M</label>
          <label><input type="checkbox" id="l_park"> L</label>
          <label><input type="checkbox" id="xl_park"> XL</label><br>

          <strong>Condition</strong><br>



          <div class="container">
            <div class="label-row">
            <h1>Kaksip√§inen liukufiltteri</h1>
            <div class="values">
            <span class="hint">Valitse v√§li:</span>
            <output id="minVal">10</output>
            <span class="hint">‚Äî</span>
            <output id="maxVal">90</output>
            </div>
            </div>


            <p class="hint">T√§m√§ esimerkki k√§ytt√§√§ kahta p√§√§llekk√§ist√§ &lt;input type="range"&gt; -elementti√§. Voit muuttaa min/max-arvoja, step:in ja tyylin oman tarpeesi mukaan.</p>


            <div class="range-wrap" aria-label="Hinnan suodatin">
            <div class="track" aria-hidden="true">
            <div class="range-highlight" id="rangeHighlight" style="left:10%;right:10%"></div>
            </div>


            <!-- pienempi arvo (vasen nuppi) -->
            <input id="rangeMin" type="range" min="0" max="100" step="1" value="10" aria-label="Minimiarvo">
            <!-- suurempi arvo (oikea nuppi) -->
            <input id="rangeMax" type="range" min="0" max="100" step="1" value="90" aria-label="Maksimiarvo">
          </div>


          <p class="hint">P√§√§ominaisuudet: n√§pp√§imist√∂tuki (nuolet), p√§√§llekk√§iset liukus√§√§timet ja visuaalinen korostus valitulle v√§lille.</p>
  



          <strong>Other features</strong><br>
          <label><input type="checkbox" id="superpipe"> Superpipe</label><br>
          <label><input type="checkbox" id="minipipe"> Minipipe</label><br>
          <label><input type="checkbox" id="moguls"> Moguls</label>
        </fieldset>

        <fieldset>
          <legend>Transport</legend>
        </fieldset>
      </div>

      <!--<button id="filterButton">FILTER</button>-->
    </div>

    <!-- ‚ÑπÔ∏è InfoBox -->
    <div id="infoBox">
      <span id="closeInfoButton">&times;</span>
      <div id="infoContent">

        <h2 id="resort-name"></h2>
        <p id="overall-description-text"></p>

        <fieldset>
          <h3>Resort info</h3>
          <div class="alingn-left-right-flexbox"><strong>Season:</strong> <span id="season-text"></span></div>
          <div class="alingn-left-right-flexbox"><strong>Resort height:</strong> <span id="height-text"></span></div>
          <div class="alingn-left-right-flexbox"><strong>Lift count:</strong> <span id="lift-count-text"></span></div>
          <div class="alingn-left-right-flexbox"><strong>Run count:</strong> <span id="run-count-text"></span></div>
          <div id="run-container"> <span id="green-run-text"></span><span id="blue-run-text"></span><span id="red-run-text"></span><span id="black-run-text"></span></div>
        </fieldset>

        <fieldset>
          <h3>Terrain park</h3>
          <div class="alingn-left-right-flexbox"><strong>Level:</strong> <div><span id="s-text"></span> <span id="m-text"></span> <span id="l-text"></span> <span id="xl-text"></span></div></div>
          <div class="alingn-left-right-flexbox"><strong>Condition:</strong> <span id="condition-text"></span></div>
          <div class="alingn-left-right-flexbox"><strong>Other features:</strong> <div class="right-content-flexbox"><span id="superpipe-text"></span> <span id="minipipe-text"></span> <span id="moguls-text"></span></div></div>
          <p id="park-description-text"></p>
        </fieldset>

        <fieldset>
          <h3>Access</h3>
          <div class="alingn-left-right-flexbox"><strong>Public transportation:</strong> <span id="has-transport-text"></span></div>
        </fieldset>


      </div>
    </div>

    <div id="map"></div>

  </div>

  <!-- üìú Leaflet -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <!-- ‚öôÔ∏è Sovelluslogiikka -->
  <script>
  document.addEventListener("DOMContentLoaded", async () => {

    // ==== KARTTA ====
    const map = L.map('map', { zoomControl: false }).setView([60.17, 24.94], 3);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 20,
      attribution: '¬© OpenStreetMap'
    }).addTo(map);
    L.control.zoom({ position: 'topright' }).addTo(map);

    // ==== ELEMENTIT ====
    const infoBox = document.getElementById('infoBox');
    const closeBtn = document.getElementById('closeInfoButton');
    const searchInput = document.getElementById('searchInput');
    const suggestions = document.getElementById('suggestions');
    const datalist = document.getElementById('countryList');

    closeBtn.onclick = () => infoBox.classList.remove('visible');

    let markers = [];
    let data = [];

    // ==== LADATAAN DATA ====
    try {
      data = await (await fetch('ski_resorts.json')).json();
    } catch (err) {
      console.error("JSON lataus ep√§onnistui:", err);
      return;
    }

    // ==== MARKKERIT ====
    data.forEach(r => {
      const m = createMarker(r).addTo(map);
      markers.push(m);
    });

    // ==== T√ÑYT√Ñ MAAT DATALISTIIN ====
    const countries = [...new Set(data.map(r => r.country))].sort();
    datalist.innerHTML = countries.map(c => `<option value="${c}">`).join('');

    // ==== FILTTERIT ====
    document.querySelectorAll('#filterBox input').forEach(el => {
      el.addEventListener('input', applyFilters);
    });

    // ==== HAKU ====
    searchInput.addEventListener('input', handleSearch);

    // ==== FUNKTIOT ====
    function createMarker(r) {
      const marker = L.circleMarker([r.lat, r.lon], {
        radius: 4,
        color: '#0074D9',
        fillColor: '#0074D9',
        fillOpacity: 0.7
      });
      marker.data = r;
      marker.on('click', () => showInfo(r));
      return marker;
    }

    function showInfo(r) {
      const byId = id => document.getElementById(id);
      byId("resort-name").textContent = r.name;
      byId("overall-description-text").textContent = r.overall_description;
      byId("season-text").textContent = `${r.season_start} ‚Äì ${r.season_end}`;
      byId("height-text").textContent = `${r.vertical_m}m`;
      byId("lift-count-text").textContent = r.lift_count;
      byId("run-count-text").textContent = r.run_count;

      setDiamond("green-run-text", r.green_run, "green");
      setDiamond("blue-run-text", r.blue_run, "blue");
      setDiamond("red-run-text", r.red_run, "red");
      setDiamond("black-run-text", r.black_run, "black");

      ["s","m","l","xl"].forEach(k => setCheck(`${k}-text`, r[`${k}_park`], k.toUpperCase()));
      showStars("condition-text", r.park_condition, 3);
      ["superpipe","minipipe","moguls"].forEach(k => setCheck(`${k}-text`, r[k], k));
      byId("park-description-text").textContent = r.park_description;
      setCheck("has-transport-text", r.has_public_trans, "", false);

      infoBox.classList.add('visible');
    }

    function setDiamond(id, val, color) {
      const el = document.getElementById(id);
      el.innerHTML = val ? `<span class='diamond ${color}'>&#9670;</span> ${val}` : "";
    }

    function setCheck(id, val, label, hideFalse = true) {
      const el = document.getElementById(id);
      if (val === true) {
        el.innerHTML = `<span style="color:green">‚úî</span> ${label}`;
      } else if (!hideFalse && val === false) {
        el.innerHTML = `<span style="color:red">‚úò</span> ${label}`;
      } else {
        el.innerHTML = "";
      }
    }

    function showStars(id, value, max = 3) {
      const el = document.getElementById(id);
      if (!value) return el.textContent = "n/a";
      el.innerHTML = "";
      for (let i = 1; i <= max; i++) {
        el.innerHTML += `<span style="color:${i <= value ? 'gold' : '#ccc'}; font-size:1.2em;">${i <= value ? '‚òÖ' : '‚òÜ'}</span>`;
      }
    }


    function applyFilters() {
      const country = document.getElementById('countryInput').value.trim().toLowerCase();
      const filters = ['xl_park', 'l_park','m_park','s_park','superpipe','minipipe','moguls']
        .reduce((acc, id) => ({ ...acc, [id]: document.getElementById(id).checked }), {});

      markers.forEach(m => {
        const d = m.data;
        const matchCountry = !country || d.country?.toLowerCase().includes(country);
        const matchParks = Object.entries(filters).every(([k, v]) => !v || d[k]);
        if (matchCountry && matchParks) m.addTo(map);
        else map.removeLayer(m);
      });

      const visible = markers.filter(m => map.hasLayer(m));
      if (visible.length) map.fitBounds(L.featureGroup(visible).getBounds());
    }

    function handleSearch() {
      const query = searchInput.value.toLowerCase().trim();
      suggestions.innerHTML = '';
      if (!query) return;

      const matches = markers
        .filter(m => m.data.name?.toLowerCase().includes(query))
        .sort((a, b) => a.data.name.localeCompare(b.data.name))
        .slice(0, 10);

      if (!matches.length) {
        suggestions.innerHTML = '<li class="no-results">Ei tuloksia</li>';
        return;
      }

      matches.forEach(m => {
        const li = document.createElement('li');
        li.textContent = m.data.name;
        li.onclick = () => selectMarker(m);
        suggestions.appendChild(li);
      });
    }

    function selectMarker(marker) {
      suggestions.innerHTML = '';
      searchInput.value = marker.data.name;
      map.setView([marker.data.lat, marker.data.lon], 14);
      marker.fire('click');
    }

  });



  // Elementit
  const rMin = document.getElementById('rangeMin');
  const rMax = document.getElementById('rangeMax');
  const outMin = document.getElementById('minVal');
  const outMax = document.getElementById('maxVal');
  const highlight = document.getElementById('rangeHighlight');


  const min = Number(rMin.min);
  const max = Number(rMin.max);


  // estet√§√§n mitta-arvojen k√§√§ntyminen yli toistensa
  function clampValues(){
  let a = Number(rMin.value);
  let b = Number(rMax.value);
  if (a > b){
  // jos alaraja ylitt√§√§ yl√§rajan, k√§√§nn√§ v√§√§r√§ liukuri takaisin
  if (this === rMin) { a = b; rMin.value = a; }
  else { b = a; rMax.value = b; }
  }
  outMin.value = a;
  outMax.value = b;
  updateHighlight(a,b);
  updateZIndices();
  }


  // p√§ivit√§ keskikorostuksen (left/right prosentteina)
  function updateHighlight(a,b){
  const leftPercent = ((a - min) / (max - min)) * 100;
  const rightPercent = 100 - ((b - min) / (max - min)) * 100;
  highlight.style.left = leftPercent + '%';
  highlight.style.right = rightPercent + '%';
  }


  // varmista ett√§ oikea thumb on p√§√§llimm√§isen√§ kun se on l√§hell√§
  function updateZIndices(){
  // aseta z-index korkein sille napille, joka on l√§himp√§n√§ toisella puolella
  if (Number(rMin.value) >= Number(rMax.value) - 1){
  rMin.style.zIndex = 3; rMax.style.zIndex = 2;
  } else {
  rMin.style.zIndex = 2; rMax.style.zIndex = 3;
  }
  }


  // initial
  clampValues.call(rMin);


  // tapahtumak√§sittelij√§t
  rMin.addEventListener('input', clampValues);
  rMax.addEventListener('input', ()=> onRangeChange(Number(rMin.value), Number(rMax.value)));
  
  </script>

</body>
</html>kok